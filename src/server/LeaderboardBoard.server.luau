local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

local BOARD_PART_NAME = "WordGameRank"
local boardPart = Workspace:WaitForChild(BOARD_PART_NAME)
print("âœ… [SERVER] æ’è¡Œæ¦œçœ‹æ¿å·²è¼‰å…¥:", boardPart.Name)

-- 1. å»ºç«‹ SurfaceGui (é¡¯ç¤ºä»‹é¢)
local surfaceGui = Instance.new("SurfaceGui")
surfaceGui.Face = Enum.NormalId.Front -- é¡¯ç¤ºåœ¨æ­£é¢
surfaceGui.SizingMode = Enum.SurfaceGuiSizingMode.PixelsPerStud
surfaceGui.PixelsPerStud = 20 -- è§£æåº¦è¨­å®š (é™ä½æ•¸å€¼è®“æ–‡å­—çœ‹èµ·ä¾†æ›´å¤§)
surfaceGui.Parent = boardPart

-- èƒŒæ™¯
local bg = Instance.new("Frame")
bg.Size = UDim2.new(1, 0, 1, 0)
bg.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
bg.BorderSizePixel = 0
bg.Parent = surfaceGui

-- æ¨™é¡Œ
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0.15, 0)
title.BackgroundColor3 = Color3.fromRGB(20, 20, 20) -- æ”¹ç‚ºæ·±è‰²èƒŒæ™¯ä»¥å‡¸é¡¯éœ“è™¹æ•ˆæœ
title.Text = "ğŸ† å‹ç‡æ’è¡Œæ¦œ ğŸ†"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBlack
title.TextScaled = true
title.Parent = bg

-- éœ“è™¹ç‡ˆé–ƒçˆæ•ˆæœ
task.spawn(function()
	local colors = {
		Color3.fromRGB(255, 0, 0),   -- ç´…
		Color3.fromRGB(255, 170, 0), -- æ©™
		Color3.fromRGB(255, 255, 0), -- é»ƒ
		Color3.fromRGB(0, 255, 0),   -- ç¶ 
		Color3.fromRGB(0, 255, 255), -- é’
		Color3.fromRGB(0, 0, 255),   -- è—
		Color3.fromRGB(255, 0, 255), -- ç´«
	}
	local index = 1
	while title.Parent do
		local tween = TweenService:Create(title, TweenInfo.new(0.5, Enum.EasingStyle.Linear), {TextColor3 = colors[index]})
		tween:Play()
		tween.Completed:Wait()
		index = (index % #colors) + 1
	end
end)

-- åˆ—è¡¨å®¹å™¨
local listContainer = Instance.new("ScrollingFrame")
listContainer.Size = UDim2.new(1, -20, 0.8, -20)
listContainer.Position = UDim2.new(0, 10, 0.18, 10)
listContainer.BackgroundTransparency = 1
listContainer.ScrollBarThickness = 6
listContainer.Parent = bg

local uiListLayout = Instance.new("UIListLayout")
uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
uiListLayout.Padding = UDim.new(0, 5)
uiListLayout.Parent = listContainer

-- è¼”åŠ©å‡½æ•¸ï¼šå»ºç«‹ä¸€è¡Œè³‡æ–™
local function createRow(rank, name, winRate, gold)
	local row = Instance.new("Frame")
	row.Size = UDim2.new(1, 0, 0, 50)
	row.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	row.BorderSizePixel = 0
	
	local text = string.format("%d. %s | å‹ç‡: %.1f%% | ğŸ’° %d", rank, name, winRate, gold)
	
	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, -20, 1, 0)
	label.Position = UDim2.new(0, 10, 0, 0)
	label.BackgroundTransparency = 1
	label.Text = text

	if rank == 1 then
		label.TextColor3 = Color3.fromRGB(255, 215, 0) -- é‡‘è‰²
	elseif rank == 2 then
		label.TextColor3 = Color3.fromRGB(192, 192, 192) -- éŠ€è‰²
	elseif rank == 3 then
		label.TextColor3 = Color3.fromRGB(205, 127, 50) -- éŠ…è‰²
	else
		label.TextColor3 = Color3.new(1, 1, 1)
	end

	label.Font = Enum.Font.GothamBold
	label.TextSize = 24
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Parent = row
	
	return row
end

-- æ›´æ–°æ’è¡Œæ¦œå‡½æ•¸
local function updateBoard()
	-- æ¸…ç©ºèˆŠè³‡æ–™
	for _, child in ipairs(listContainer:GetChildren()) do
		if child:IsA("Frame") then child:Destroy() end
	end

	local data = {}
	for _, player in ipairs(Players:GetPlayers()) do
		local ls = player:FindFirstChild("leaderstats")
		if ls then
			local gold = ls:FindFirstChild("Gold") and ls.Gold.Value or 0
			local totalCorrect = ls:FindFirstChild("TotalCorrect") and ls.TotalCorrect.Value or 0
			local totalAnswered = ls:FindFirstChild("TotalAnswered") and ls.TotalAnswered.Value or 0
			
			local winRate = 0
			if totalAnswered > 0 then
				winRate = (totalCorrect / totalAnswered) * 100
			end
			
			table.insert(data, {name = player.Name, winRate = winRate, gold = gold})
		end
	end

	-- æ’åºï¼šå‹ç‡é«˜è€…å„ªå…ˆï¼Œè‹¥å‹ç‡ç›¸åŒå‰‡æ¯”é‡‘å¹£
	table.sort(data, function(a, b)
		if math.abs(a.winRate - b.winRate) > 0.1 then
			return a.winRate > b.winRate
		end
		return a.gold > b.gold
	end)

	-- é¡¯ç¤º
	for i, entry in ipairs(data) do
		local row = createRow(i, entry.name, entry.winRate, entry.gold)
		row.Parent = listContainer
	end
end

-- æ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡
while true do
	updateBoard()
	task.wait(5)
end